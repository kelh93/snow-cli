#!/usr/bin/env node

const figlet = require('figlet');
const lolcatjs = require('lolcatjs');
const { program } = require('commander');
const inquirer = require('inquirer');
const chalk = require('chalk');
const ora = require('ora');
// const osHomedir = require('os-homedir');
const shell = require('shelljs');
const download = require('download-git-repo');

lolcatjs.options.seed = Math.round(Math.random() * 1000);
lolcatjs.options.colors = true;

const myName = figlet.textSync('SNOW CLI');
const version = 'v1.0.0';
const ads = myName + '\n' + '^v^ @kelh93 ' + version;
lolcatjs.fromString(ads);

const templateUrl = 'direct:https://github.com/kelh93/webpack5-toolkit.git';

const eventsHandler = {
  init() {
    // console.log('åˆå§‹åŒ–é¡¹ç›®');

    inquirer
      .prompt([
        {
          type: 'text',
          message: 'ğŸ“‚ project name:',
          name: 'project',
        },
        {
          type: 'list',
          name: 'type',
          choices: ['âœ” React', 'âœ” Vue2', 'âœ” Vue3', 'âœ” Playground'],
        },
      ])
      .then((answers) => {
        const _dirname = answers.project;
        if (_dirname) {
          // const spinner = ora('Create Project').start();
          console.log(chalk.white('ğŸ”¨ æ­£åœ¨åˆ›å»ºé¡¹ç›®ç›®å½•'));
          const _pwd = shell.pwd().stdout;
          const __projectPath = `${_pwd}/${_dirname}`;
          shell.cd(_pwd);
          shell.rm('-rf', __projectPath);
          shell.mkdir(_dirname);
          console.log(chalk.green('ğŸ† åˆ›å»ºæˆåŠŸ'));
        }

        switch (answers.type) {
          case 'âœ” React':
            const spinner = ora(chalk.green('áƒš(â€²â—‰â¥â—‰ï½€áƒš) download template...')).start();
            download(templateUrl, __projectPath, { clone: true }, (err) => {
              spinner.stop();
              if (err) {
                console.error(chalk.red('ä¸‹è½½å‡ºé”™äº†'), err);
              } else {
                console.log(chalk.green('âœ” ä¸‹è½½æˆåŠŸ'));
                // æ›¿æ¢é¡¹ç›®åç§°
                // shell.sed('-i', 'aaa', _dirname, __projectPath + '/package.json');
              }
            });
            break;
          case 'âœ” Vue2':
            console.log(chalk.yellow('>_< Vue2æš‚æœªå¼€å‘, æ•¬è¯·æœŸå¾…~'));
            break;
          case 'âœ” Vue3':
            console.log(chalk.yellow('>_< Vue3æš‚æœªå¼€å‘, æ•¬è¯·æœŸå¾…~'));
            break;
          case 'âœ” Playground':
            console.log(chalk.green('ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»  æ¬¢è¿æ¥åˆ°æ¼”ç»ƒåœº~'));
            break;
          default:
            break;
        }
        // if(type == 'react'){
        //   console.log('i got it')
        // }
      })
      .catch((error) => {
        if (error.isTtyError) {
          // Prompt couldn't be rendered in the current environment
        } else {
          // Something else went wrong
        }
      });
  },
  json2ts() {},
};

program.version(ads, '-v, --version');
program.option('-i, --init', 'ğŸ”¨ åˆå§‹åŒ–é¡¹ç›®');
program
  .usage('<cmd>')
  .arguments('<cmd>')
  .action(function (cmd, options) {
    const result = eventsHandler[cmd];
    if (result) {
      result();
    } else {
    }
    // console.log(cmd);
  });

program.parse(process.argv);

// console.log(result);
